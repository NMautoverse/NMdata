<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Merge, order, and check resulting rows and columns. — mergeCheck • NMdata</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Merge, order, and check resulting rows and columns. — mergeCheck"><meta property="og:description" content="Stop checking that the number of rows is unchanged after a merge -
mergeCheck checks what you really want - i.e. x is extended with
columns from y while all rows in x are retained, and no new rows
are created (plus some more checks). mergeCheck is not a merge implementation - it is a
useful merge wrapper. The advantage over using much more flexible
merge or join function lies in the fully automated checking that
the results are consistent with the simple merge described above."><meta property="og:image" content="https://philipdelff.github.io/NMdata/reference/figures/apple-touch-icon-180x180.png"><meta property="og:image:alt" content="Efficient data preparation, consistency-checking and post-processing in PK/PD modeling"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NMdata</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.11.915</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="https://htmlpreview.github.io/?https://github.com/philipdelff/NMdata/blob/master/vignettes/NMdata-cheat.html" class="external-link">Cheat Sheet</a>
    </li>
    <li>
      <a href="../articles/NMscanData.html">NMscanData: find and combine all output and input data</a>
    </li>
    <li>
      <a href="../articles/DataPrepare.html">Data Preparation Tools</a>
    </li>
    <li>
      <a href="../articles/NMdata-FAQ.html">FAQ</a>
    </li>
  </ul></li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://github.com/philipdelff/NMdata/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/philipdelff/NMdata/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Merge, order, and check resulting rows and columns.</h1>
    <small class="dont-index">Source: <a href="https://github.com/philipdelff/NMdata/blob/HEAD/R/mergeCheck.R" class="external-link"><code>R/mergeCheck.R</code></a></small>
    <div class="hidden name"><code>mergeCheck.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Stop checking that the number of rows is unchanged after a merge -
mergeCheck checks what you really want - i.e. x is extended with
columns from y while all rows in x are retained, and no new rows
are created (plus some more checks). mergeCheck is not a merge implementation - it is a
useful merge wrapper. The advantage over using much more flexible
merge or join function lies in the fully automated checking that
the results are consistent with the simple merge described above.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">mergeCheck</span><span class="op">(</span>
  <span class="va">x</span>,
  <span class="va">y</span>,
  <span class="va">by</span>,
  <span class="va">by.x</span>,
  <span class="va">by.y</span>,
  fun.commoncols <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span>,
  <span class="va">ncols.expect</span>,
  track.msg <span class="op">=</span> <span class="cn">FALSE</span>,
  <span class="va">quiet</span>,
  <span class="va">df1</span>,
  <span class="va">df2</span>,
  fun.na.by <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span>,
  <span class="va">as.fun</span>,
  <span class="va">...</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>A data.frame with the number of rows must should be
obtained from the merge. The resulting data.frame will be
ordered like x.</p></dd>
<dt>y</dt>
<dd><p>A data.frame that will be merged onto x.</p></dd>
<dt>by</dt>
<dd><p>The column(s) to merge by. Character string (vector). by
or by.x and by.y must be supplied.</p></dd>
<dt>by.x</dt>
<dd><p>If the columns to merge by in x and y are named
differently. by or by.x and by.y must be supplied.</p></dd>
<dt>by.y</dt>
<dd><p>If the columns to merge by in x and y are named
differently. by or by.x and by.y must be supplied.</p></dd>
<dt>fun.commoncols</dt>
<dd><p>If common columns are found in x and y, and
they are not used in by, this will create columns named like
col.x and col.y in result (see ?merge). Often, this is a
mistake, and the default is to throw a warning if this
happens. If using mergeCheck in a function, you may want to
make sure this is not happening and use
fun.commoncols=stop. If you want nothing to happen, you can do
fun.commoncols=NULL.</p></dd>
<dt>ncols.expect</dt>
<dd><p>If you want to include a check of the number
of columns being added to the dimensions of x. So if
ncols.expect=1, the resulting data must have exactly one
column more than x - if not, an error will be returned.</p></dd>
<dt>track.msg</dt>
<dd><p>If using mergeCheck inside other functions, it
can be useful to use track.msg=TRUE. This will add information
to messages/warnings/errors that they came from mergCheck.</p></dd>
<dt>quiet</dt>
<dd><p>If FALSE, the names of the added columns are
reported. Default value controlled by NMdataConf.</p></dd>
<dt>df1</dt>
<dd><p>Deprecated. Use x.</p></dd>
<dt>df2</dt>
<dd><p>Deprecated. Use y.</p></dd>
<dt>fun.na.by</dt>
<dd><p>If NA's are found in (matched) by columns in both
x and why, what should we do? This could be OK, but in many
cases, it's because something unexpected is happening. Use
fun.na.by=NULL in cases where you really don't care about this
and want to go ahead regardless.</p></dd>
<dt>as.fun</dt>
<dd><p>The default is to return a data.table if x is a
data.table and return a data.frame in all other cases. Pass a
function in as.fun to convert to something else.</p></dd>
<dt>...</dt>
<dd><p>additional arguments passed to data.table::merge. If
all is among them, an error will be returned.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>a data.frame resulting from merging x and y. Class as
    defined by as.fun.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Besides merging and checking rows, mergeCheck makes sure
    the order in x is retained in the resulting data (both rows
    and column order). Also, a warning is given if column names
    are overlapping, making merge create new column names like
    col.x and col.y. Merges and other operations are done using
    data.table. If x is a data.frame (and not a data.table), it
    will internally be converted to a data.table, and the
    resulting data.table will be converted back to a data.frame
    before returning.</p>
<p>mergeCheck is for the kind of merges where we think of x
    as the data to be enriched with columns from y - rows
    unchanged. This is even further limited than a left join where
    you can match rows multiple times. A common example of the use
    of mergeCheck is for adding covariates to a pk/pd data set. We
    do not want that to remove or duplicate doses, observations, or
    simulation records. In those cases, mergeCheck does all needed
    checks, and you can run full speed without checking dimensions
    (which is anyway not exactly the right thing to do in the
    general case) or worry that something might go wrong.</p>
<p>Checks performed:</p>
<ul><li><p>x has &gt;0 rows</p></li>
<li><p>by columns are present in x an y</p></li>
<li><p>Merge is not performed on NA values. If by=ID and both x$ID and
y$ID contain NA's, an error is thrown (see argument fun.na.by).</p></li>
<li><p>Merge is done by all common column names in x and y. A
warning is thrown if there are column names that are not being
used to merge by. This will result in two columns named like BW.x
and BW.y and is often unintended.</p></li>
<li><p>Before merging a row counter is added to x. After the merge, the
result is assured to have exactly one occurrance of each of the
values of the row counter in x.</p></li>
</ul><p>Moreover, row and column order from x is retained in the result.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other DataCreate: 
<code><a href="NMorderColumns.html">NMorderColumns</a>()</code>,
<code><a href="NMstamp.html">NMstamp</a>()</code>,
<code><a href="findCovs.html">findCovs</a>()</code>,
<code><a href="findVars.html">findVars</a>()</code>,
<code><a href="flagsAssign.html">flagsAssign</a>()</code>,
<code><a href="flagsCount.html">flagsCount</a>()</code>,
<code><a href="tmpcol.html">tmpcol</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"> <span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span>
<span class="r-in">                   y<span class="op">=</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,</span>
<span class="r-in">                   stringsAsFactors<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-in"> <span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">11</span><span class="op">]</span>,</span>
<span class="r-in">                   x2 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">11</span>,</span>
<span class="r-in">                   stringsAsFactors<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"> <span class="va">mc1</span> <span class="op">&lt;-</span> <span class="fu">mergeCheck</span><span class="op">(</span><span class="va">df1</span>,<span class="va">df2</span>,by<span class="op">=</span><span class="st">"y"</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Column(s) added: x2</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Notice as opposed to most merge/join algorithms, mergeCheck by</span></span>
<span class="r-in"><span class="co">#default retains both row and column order from x</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">df1</span><span class="op">)</span>,<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">df2</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     y  x x2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1: a  1  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2: b  2  2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3: c  3  3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4: d  4  4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5: e  5  5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6: f  6  6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7: g  7  7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8: h  8  8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9: i  9  9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10: j 10 10</span>
<span class="r-in"><span class="co">## Here we get a duplicate of a df1 row in the result. If we only</span></span>
<span class="r-in"><span class="co">## check dimensions, we make a mistake. mergeCheck captures the</span></span>
<span class="r-in"><span class="co">## error - and tell us where to find the problem (ID 31 and 180):</span></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="va">pk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/data/xgxr2.rds"</span>,package<span class="op">=</span><span class="st">"NMdata"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">dt.cov</span> <span class="op">&lt;-</span> <span class="va">pk</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span>ID<span class="op">=</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span class="r-in"><span class="va">dt.cov</span><span class="op">[</span>,<span class="va">COV</span><span class="op">:=</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,size<span class="op">=</span><span class="va">.N</span>,replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span>
<span class="r-in"><span class="va">dt.cov</span> <span class="op">&lt;-</span> <span class="va">dt.cov</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">.N</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">pk</span><span class="op">)</span></span>
<span class="r-in"><span class="va">res.merge</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">pk</span>,<span class="va">dt.cov</span>,by<span class="op">=</span><span class="st">"ID"</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">res.merge</span><span class="op">)</span></span>
<span class="r-in"><span class="fu">mergeCheck</span><span class="op">(</span><span class="va">pk</span>,<span class="va">dt.cov</span>,by<span class="op">=</span><span class="st">"ID"</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Philip Delff.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer></div>

  


  <script data-goatcounter="https://nmdata.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script></body></html>

