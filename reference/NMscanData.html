<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Automatically find Nonmem input and output tables and organize data — NMscanData • NMdata</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Automatically find Nonmem input and output tables and organize data — NMscanData"><meta property="og:description" content="This is a very general solution to automatically identifying, reading, and  merging all output and input data in a Nonmem model. The most important
steps are
Read and combine output tables,
If wanted, read input data and restore variables that were not output from the Nonmem model
If wanted, also restore rows from input data that were disregarded in
Nonmem (e.g. observations or subjects that are not part of the analysis)

"><meta property="og:image" content="https://philipdelff.github.io/NMdata/reference/figures/apple-touch-icon-180x180.png"><meta property="og:image:alt" content="Efficient data preparation, consistency-checking and post-processing in PK/PD modeling"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NMdata</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.17.904</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="https://htmlpreview.github.io/?https://github.com/philipdelff/NMdata/blob/master/vignettes/NMdata-cheat.html" class="external-link">Cheat Sheet</a>
    </li>
    <li>
      <a href="../articles/NMscanData.html">NMscanData: find and combine all output and input data</a>
    </li>
    <li>
      <a href="../articles/DataPrepare.html">Data Preparation Tools</a>
    </li>
    <li>
      <a href="../articles/NMdata-FAQ.html">FAQ</a>
    </li>
  </ul></li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://github.com/philipdelff/NMdata/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/philipdelff/NMdata/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Automatically find Nonmem input and output tables and organize data</h1>
    <small class="dont-index">Source: <a href="https://github.com/philipdelff/NMdata/blob/HEAD/R/NMscanData.R" class="external-link"><code>R/NMscanData.R</code></a></small>
    <div class="hidden name"><code>NMscanData.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This is a very general solution to automatically identifying, reading, and  merging all output and input data in a Nonmem model. The most important
steps are</p><ul><li><p>Read and combine output tables,</p></li>
<li><p>If wanted, read input data and restore variables that were not output from the Nonmem model</p></li>
<li><p>If wanted, also restore rows from input data that were disregarded in
Nonmem (e.g. observations or subjects that are not part of the analysis)</p></li>
</ul></div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">NMscanData</span><span class="op">(</span></span>
<span>  <span class="va">file</span>,</span>
<span>  <span class="va">col.row</span>,</span>
<span>  <span class="va">use.input</span>,</span>
<span>  <span class="va">merge.by.row</span>,</span>
<span>  <span class="va">recover.rows</span>,</span>
<span>  <span class="va">file.mod</span>,</span>
<span>  <span class="va">dir.data</span>,</span>
<span>  <span class="va">file.data</span>,</span>
<span>  translate.input <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">quiet</span>,</span>
<span>  <span class="va">use.rds</span>,</span>
<span>  <span class="va">args.fread</span>,</span>
<span>  <span class="va">as.fun</span>,</span>
<span>  col.id <span class="op">=</span> <span class="st">"ID"</span>,</span>
<span>  <span class="va">modelname</span>,</span>
<span>  <span class="va">col.model</span>,</span>
<span>  <span class="va">col.nmout</span>,</span>
<span>  <span class="va">rep.count</span>,</span>
<span>  order.columns <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">check.time</span>,</span>
<span>  <span class="va">tz.lst</span>,</span>
<span>  skip.absent <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">tab.count</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>file</dt>
<dd><p>Path to a Nonmem control stream or output file from
Nonmem (.mod or .lst)</p></dd>


<dt>col.row</dt>
<dd><p>A column with a unique value for each row. Such a
column is recommended to use if possible. See merge.by.row and
details as well. Default ("ROW") can be modified using
NMdataConf.</p></dd>


<dt>use.input</dt>
<dd><p>Should the input data be added to the output
data. Only column names that are not found in output data will
be retrieved from the input data. Default is TRUE which can be
modified using NMdataConf. See merge.by.row too.</p></dd>


<dt>merge.by.row</dt>
<dd><p>If use.input=TRUE, this argument determines
the method by which the input data is added to output
data. The default method (merge.by.row=FALSE) is to interpret
the Nonmem code to imitate the data filtering (IGNORE and
ACCEPT statements), but the recommended method is
merge.by.row=TRUE which means that data will be merged by a
unique row identifier. The row identifier must be present in
input and at least one full length output data table. See
argument col.row too.</p></dd>


<dt>recover.rows</dt>
<dd><p>Include rows from input data files that do not
exist in output tables? This will be added to the $row dataset
only, and $run, $id, and $occ datasets are created before this
is taken into account. A column called nmout will be TRUE when
the row was found in output tables, and FALSE when
not. Default is FALSE and can be configured using NMdataConf.</p></dd>


<dt>file.mod</dt>
<dd><p>The input control stream file path. Default is to
look for \"file\" with extension changed to .mod (PSN
style). You can also supply the path to the file, or you can
provide a function that translates the output file path to the
input file path. The default behavior can be configured using
NMdataConf. See dir.data too.</p></dd>


<dt>dir.data</dt>
<dd><p>The data directory can only be read from the
control stream (.mod) and not from the output file (.lst). So
if you only have the output control stream, use dir.data to
tell in which directory to find the data file. If dir.data is
provided, the .mod file is not used at all.</p></dd>


<dt>file.data</dt>
<dd><p>Specification of the data file path. When this is
used, the control streams are not used at all.</p></dd>


<dt>translate.input</dt>
<dd><p>Default is TRUE, meaning that input data
column names are translated according to $INPUT section in
Nonmem listing file.</p></dd>


<dt>quiet</dt>
<dd><p>The default is to give some information along the way
on what data is found. But consider setting this to TRUE for
non-interactive use. Default can be configured using
NMdataConf.</p></dd>


<dt>use.rds</dt>
<dd><p>If an rds file is found with the exact same name
(except for .rds instead of say .csv) as the input data file
mentioned in the Nonmem control stream, should this be used
instead? The default is yes, and NMwriteData will create this
by default too. Default can be configured using NMdataConf.</p></dd>


<dt>args.fread</dt>
<dd><p>List of arguments passed to when reading _input_
data. Notice that except for "input" and "file", you need to
supply all arguments to fread if you use this
argument. Default values can be configured using NMdataConf.</p></dd>


<dt>as.fun</dt>
<dd><p>The default is to return data as a data.frame. Pass
a function (say tibble::as_tibble) in as.fun to convert to
something else. If data.tables are wanted, use
as.fun="data.table". The default can be configured using
NMdataConf.</p></dd>


<dt>col.id</dt>
<dd><p>The name of the subject ID variable, default is
"ID".</p></dd>


<dt>modelname</dt>
<dd><p>The model name to be stored if col.model is not
NULL. If not supplied, the name will be taken from the control
stream file name by omitting the directory/path and deleting
the .lst extension (path/run001.lst becomes run001). This can
be a character string or a function which is called on the
value of file (file is another argument to NMscanData). The
function must take one character argument and return another
character string. As example, see NMdataConf()$modelname. The
default can be configured using NMdataConf.</p></dd>


<dt>col.model</dt>
<dd><p>A column of this name containing the model name
will be included in the returned data. The default is to store
this in a column called "model". See argument "modelname" as
well. Set to NULL if not wanted. Default can be configured
using NMdataConf.</p></dd>


<dt>col.nmout</dt>
<dd><p>A column of this name will be a logical
representing whether row was in output table or not. Default
can be modified using NMdataConf.</p></dd>


<dt>rep.count</dt>
<dd><p>Nonmem includes a counter of tables in the
written data files. These are often not useful. Especially for
NMscanData output it can be meaningless because multiple
tables can be combined so this information is not unique
across those source tables. However, if rep.count is TRUE (not
default), this will be carried forward and added as a column
called NMREP. The argument is passed to NMscanTables.</p></dd>


<dt>order.columns</dt>
<dd><p>If TRUE (default), NMorderColumns is used to
reorder the columns before returning the data. NMorderColumns
will be called with alpha=FALSE, so columns are not sorted
alphabetically. But standard Nonmem columns like ID, TIME, and
other will be first. If col.row is used, this will be passed
to NMorderColumns too.</p></dd>


<dt>check.time</dt>
<dd><p>If TRUE (default) and if input data is used,
input control stream and input data are checked to be newer
than output control stream and output tables. These are
important assumptions for the way information is merged by
NMscanData. However, if data has been transferred from another
system where Nonmem was run, these checks may not make sense,
and you may not want to see these warnings. The default can be
configured using NMdataConf. For the output control stream,
the time stamp recorded by Nonmem is used if possible, and if
the input data is created with NMwriteData, the recorded
creation time is used if possible. If not, and for all other
files, the file modification times are used.</p></dd>


<dt>tz.lst</dt>
<dd><p>If supplied, the timezone to be used when reading
the time stamp in the output control stream. Please supply
something listed in OlsonNames(). Can be configured using
NMdataConf() too.</p></dd>


<dt>skip.absent</dt>
<dd><p>Skip missing output table files with a warning?
Default is FALSE in which case an error is thrown.</p></dd>


<dt>tab.count</dt>
<dd><p>Deprecated. Use rep.count.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A data set of class 'NMdata'.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function makes it very easy to collect the data from
    a Nonmem run.</p>
<p>A useful feature of this function is that it can automatically
combine "input" data (the data read by Nonmem in $INPUT or
$INFILE) with "output" data (tables written by Nonmem in
$TABLE). There are two implemented methods for doing so. One (the
default but not recommended) relies on interpretation of filter
(IGNORE and ACCEPT) statements in $INPUT. This will work in most
cases, and checks for consistency with Nonmem results. However,
the recommended method is using a unique row identifier in both
input data and at least one output data file (not a FIRSTONLY or
LASTONLY table). Supply the name of this column using the col.row
argument.</p>
<p>Limitations. A number of Nonmem features are not supported. Most
of this can be overcome by using merge.by.row=TRUE. Incomplete
list of known limitations:</p>
<ul><li><p>character TIMEIf Nonmem is used to translate DAY and a character TIME column, TIME has to be available in an output table. NMscanData does not do the translation to numeric.</p></li>
<li><p>RECORDSThe RECORDS option to limit the part of the input data being used is not searched for. Using merge.by.row=TRUE will work unaffectedly.</p></li>
<li><p>NULLThe NULL argument to specify missing value string in input data is not respected. If delimited input data is read (as opposed to rds files), missing values are assumed to be represented by dots (.).</p></li>
</ul></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other DataRead: 
<code><a href="NMreadCsv.html">NMreadCsv</a>()</code>,
<code><a href="NMreadTab.html">NMreadTab</a>()</code>,
<code><a href="NMscanInput.html">NMscanInput</a>()</code>,
<code><a href="NMscanTables.html">NMscanTables</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu">NMscanData</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/nonmem/xgxr001.lst"</span>, package<span class="op">=</span><span class="st">"NMdata"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model:  xgxr001 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Used tables, contents shown as used/total:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               file     rows columns     IDs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    xgxr001_res.txt  905/905   16/16 150/150</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  xgxr1.csv (input) 905/1502   22/24 150/150</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           (result)      905    38+2     150</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Input and output data merged by: ROW </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Distribution of rows on event types in returned data:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  EVID CMT output result</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     0   2    755    755</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1   1    150    150</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   All All    905    905</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Philip Delff.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  <script data-goatcounter="https://nmdata.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script></body></html>

