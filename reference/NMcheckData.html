<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Check data for Nonmem compatibility or check control stream for data compatibility — NMcheckData • NMdata</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><script src="../extra.js"></script><meta property="og:title" content="Check data for Nonmem compatibility or check control stream for data compatibility — NMcheckData"><meta property="og:description" content="Check data in various ways for compatibility with Nonmem. Some
findings will be reported even if they will not make Nonmem fail
but because they are typical dataset issues."><meta property="og:image" content="https://nmautoverse.github.io/NMdata/reference/figures/apple-touch-icon-180x180.png"><meta property="og:image:alt" content="Efficient data preparation, consistency-checking and post-processing in PK/PD modeling"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NMdata</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>

  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="https://htmlpreview.github.io/?https://github.com/nmautoverse/NMdata/blob/master/vignettes/NMdata-cheat.html" class="external-link">Cheat Sheet</a>
    </li>
    <li>
      <a href="../articles/NMscanData.html">NMscanData: find and combine all output and input data</a>
    </li>
    <li>
      <a href="../articles/ParameterTables.html">Flexible Creation of Parameter Tables</a>
    </li>
    <li>
      <a href="../articles/DataPrepare.html">Data Preparation Tools</a>
    </li>
    <li>
      <a href="../articles/NMdata-FAQ.html">FAQ</a>
    </li>
  </ul></li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://github.com/nmautoverse/NMdata/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/nmautoverse/NMdata/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Check data for Nonmem compatibility or check control stream for data compatibility</h1>
    <small class="dont-index">Source: <a href="https://github.com/nmautoverse/NMdata/blob/master/R/NMcheckData.R" class="external-link"><code>R/NMcheckData.R</code></a></small>
    <div class="hidden name"><code>NMcheckData.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Check data in various ways for compatibility with Nonmem. Some
findings will be reported even if they will not make Nonmem fail
but because they are typical dataset issues.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">NMcheckData</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">file</span>,</span>
<span>  <span class="va">covs</span>,</span>
<span>  <span class="va">covs.occ</span>,</span>
<span>  <span class="va">cols.num</span>,</span>
<span>  col.id <span class="op">=</span> <span class="st">"ID"</span>,</span>
<span>  col.time <span class="op">=</span> <span class="st">"TIME"</span>,</span>
<span>  col.dv <span class="op">=</span> <span class="st">"DV"</span>,</span>
<span>  col.mdv <span class="op">=</span> <span class="st">"MDV"</span>,</span>
<span>  col.cmt <span class="op">=</span> <span class="st">"CMT"</span>,</span>
<span>  col.amt <span class="op">=</span> <span class="st">"AMT"</span>,</span>
<span>  <span class="va">col.flagn</span>,</span>
<span>  <span class="va">col.row</span>,</span>
<span>  <span class="va">col.usubjid</span>,</span>
<span>  <span class="va">cols.dup</span>,</span>
<span>  type.data <span class="op">=</span> <span class="st">"est"</span>,</span>
<span>  <span class="va">cols.disable</span>,</span>
<span>  <span class="va">na.strings</span>,</span>
<span>  return.summary <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">as.fun</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>The data to check. <code>data.frame</code>,
<code>data.table</code>, <code>tibble</code>, anything that can be
converted to <code>data.table</code>.</p></dd>


<dt id="arg-file">file<a class="anchor" aria-label="anchor" href="#arg-file"></a></dt>
<dd><p>Alternatively to checking a data object, you can use
file to specify a control stream to check. This can either be
a (working or non-working) input control stream or an output
control stream. In this case, <code>NMdataCheck</code> checks column
names in data against control stream (see
<code>NMcheckColnames</code>), reads the data as Nonmem would do,
and do the same checks on the data as NMdataCheck would do
using the data argument. <code>col.flagn</code> is ignored in this
case - instead, ACCEPT/IGNORE statements in control stream are
applied. The file argument is useful for debugging a Nonmem
model.</p></dd>


<dt id="arg-covs">covs<a class="anchor" aria-label="anchor" href="#arg-covs"></a></dt>
<dd><p>columns that contain subject-level covariates. They
are expected to be non-missing, numeric and not varying within
subjects.</p></dd>


<dt id="arg-covs-occ">covs.occ<a class="anchor" aria-label="anchor" href="#arg-covs-occ"></a></dt>
<dd><p>A list specifying columns that contain
subject:occasion-level covariates. They are expected to be
non-missing, numeric and not varying within combinations of
subject and occasion. <code>covs.occ=list(PERIOD=c("FED"))</code>
means that <code>FED</code> is the covariate, while <code>PERIOD</code>
indicates the occasion.</p></dd>


<dt id="arg-cols-num">cols.num<a class="anchor" aria-label="anchor" href="#arg-cols-num"></a></dt>
<dd><p>Columns that are expected to be present, numeric
and non-NA. If a character vector is given, the columns are
expected to be used in all rows. If a column is only used for
a subset of rows, use a list and name the elements by
subsetting strings. See examples.</p></dd>


<dt id="arg-col-id">col.id<a class="anchor" aria-label="anchor" href="#arg-col-id"></a></dt>
<dd><p>The name of the column that holds the subject
identifier. Default is "ID".</p></dd>


<dt id="arg-col-time">col.time<a class="anchor" aria-label="anchor" href="#arg-col-time"></a></dt>
<dd><p>The name of the column holding actual time.</p></dd>


<dt id="arg-col-dv">col.dv<a class="anchor" aria-label="anchor" href="#arg-col-dv"></a></dt>
<dd><p>The name of the column holding the dependent
variable. For now, only one column can be specified, and
<code>MDV</code> is assumed to match this column. Default is
<code>DV</code>.</p></dd>


<dt id="arg-col-mdv">col.mdv<a class="anchor" aria-label="anchor" href="#arg-col-mdv"></a></dt>
<dd><p>The name of the column holding the binary indicator
of the dependent variable missing. Default is <code>MDV</code>.</p></dd>


<dt id="arg-col-cmt">col.cmt<a class="anchor" aria-label="anchor" href="#arg-col-cmt"></a></dt>
<dd><p>The name(s) of the compartment column(s). These
will be checked to be positive integers for all rows. They are
also used in checks for row duplicates.</p></dd>


<dt id="arg-col-amt">col.amt<a class="anchor" aria-label="anchor" href="#arg-col-amt"></a></dt>
<dd><p>The name of the dose amount column.</p></dd>


<dt id="arg-col-flagn">col.flagn<a class="anchor" aria-label="anchor" href="#arg-col-flagn"></a></dt>
<dd><p>Optionally, the name of the column holding
numeric exclusion flags. Default value is <code>FLAG</code> and can
be configured using <code>NMdataConf</code>. Even though <code>FLAG</code>
is the default value, no finding will be returned if the
column is missing unless explicitly defined as
<code>col.flagn="FLAG"</code>. This is because this way of using
exclusion flags is only one of many ways you could choose to
handle exclusions. Disable completely by using
<code>col.flagn=FALSE</code>.</p></dd>


<dt id="arg-col-row">col.row<a class="anchor" aria-label="anchor" href="#arg-col-row"></a></dt>
<dd><p>A column with a unique value for each row. Such a
column is recommended to use if possible. Default
(<code>"ROW"</code>) can be modified using <code>NMdataConf</code>.</p></dd>


<dt id="arg-col-usubjid">col.usubjid<a class="anchor" aria-label="anchor" href="#arg-col-usubjid"></a></dt>
<dd><p>Optional unique subject identifier. It is
recommended to keep a unique subject identifier (typically a
character string including an abbreviated study name and the
subject id) from the clinical datasets in the analysis set. If
you supply the name of the column holding this identifier,
NMcheckData will check that it is non-missing, that it is
unique within values of col.id (i.e. that the analysis subject
ID's are unique across actual subjects), and that col.id is
unique within the unique subject ID (a violation of the latter
is less likely).</p></dd>


<dt id="arg-cols-dup">cols.dup<a class="anchor" aria-label="anchor" href="#arg-cols-dup"></a></dt>
<dd><p>Additional column names to consider in search of
duplicate events. <code>col.id</code>, <code>col.cmt</code>,
<code>col.evid</code>, and <code>col.time</code> are always considered if
found in data, and <code>cols.dup</code> is added to this list if
provided.</p></dd>


<dt id="arg-type-data">type.data<a class="anchor" aria-label="anchor" href="#arg-type-data"></a></dt>
<dd><p><code>"est"</code> for estimation data (default), and
<code>"sim"</code> for simulation data. Differences are that
<code>col.row</code> is not expected for simulation data, and
subjects will be checked to have <code>EVID==0</code> rows for
estimation data and <code>EVID==2</code> rows for simulation data.</p></dd>


<dt id="arg-cols-disable">cols.disable<a class="anchor" aria-label="anchor" href="#arg-cols-disable"></a></dt>
<dd><p>Columns to not check. This is particularly
useful when checking data sets that do not include i.e. `CMT`,
`EVID`, and others. To skip checking specific columns, provide
their names like `cols.disable=c("CMT","EVID")`.</p></dd>


<dt id="arg-na-strings">na.strings<a class="anchor" aria-label="anchor" href="#arg-na-strings"></a></dt>
<dd><p>Strings to be accepted when trying to convert
characters to numerics. This will typically be a string that
represents missing values. Default is ".". Notice, actual
<code>NA</code>, i.e. not a string, is allowed independently of
<code>na.strings</code>. See <code><a href="NMisNumeric.html">?NMisNumeric</a></code>.</p></dd>


<dt id="arg-return-summary">return.summary<a class="anchor" aria-label="anchor" href="#arg-return-summary"></a></dt>
<dd><p>If TRUE (not default), the table summary
that is printed if <code>quiet=FALSE</code> is returned as well. In
that case, a list is returned, and the findings are in an
element called findings.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>Keep quiet? Default is not to.</p></dd>


<dt id="arg-as-fun">as.fun<a class="anchor" aria-label="anchor" href="#arg-as-fun"></a></dt>
<dd><p>The default is to return data as a
<code>data.frame</code>. Pass a function (say
<code><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">tibble::as_tibble</a></code>) in as.fun to convert to something
else. If <code>data.tables</code> are wanted, use
<code>as.fun="data.table"</code>. The default can be configured
using <code>NMdataConf</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A table with findings</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The following checks are performed. The term "numeric"
    does not refer to a numeric representation in R, but
    compatibility with Nonmem. The character string "2" is in this
    sense a valid numeric, "id2" is not.</p><ul><li><p>Column
    names must be unique and not contain special characters</p></li>
<li><p>If an exclusion flag is used (for ACCEPT/IGNORE in Nonmem),
    elements must be non-missing and integers. Notice, if an exclusion
    flag is found, the rest of the checks are performed on rows
    where that flag equals 0 (zero) only.</p></li>
<li><p>If a unique row identifier is found, it has to be
non-missing, increasing integers.</p></li>
<li><p>col.time (TIME),
    <code>EVID</code>, col.id (<code>ID</code>), col.cmt (<code>CMT</code>), and <code>col.mdv</code> (<code>MDV</code>): If present, elements must be non-missing
    and numeric.</p></li>
<li><p>col.time (TIME) must be non-negative</p></li>
<li><p><code>EVID</code> must be in {0,1,2,3,4}.</p></li>
<li><p>CMT must be positive integers. However, can be missing or zero for <code>EVID==3</code>.</p></li>
<li><p>MDV must be the binary (1/0) representation of <code>is.na(DV)</code> for
dosing records (<code>EVID==0</code>).</p></li>
<li><p>AMT must be 0 or <code>NA</code> for <code>EVID</code> 0 and 2</p></li>
<li><p>AMT must be positive for <code>EVID</code> 1 and 4</p></li>
<li><p>DV must be numeric</p></li>
<li><p>DV must be missing for <code>EVID</code> in {1,4}.</p></li>
<li><p>If found, RATE must be a numeric, equaling -2 or non-negative for dosing events.</p></li>
<li><p>If found, SS must be a numeric, equaling 0 or 1 for dosing records.</p></li>
<li><p>If found, <code>ADDL</code> must be a non-negative integer for dosing
records. II must be present.</p></li>
<li><p>If found, II must be a non-negative integer for dosing
records. <code>ADDL</code> must be present.</p></li>
<li><p>ID must be positive and values cannot be disjoint (all
    records for each ID must be following each other. This is
    technically not a requirement in Nonmem but most often an
    error. Use a second ID column if you deliberately want to
    soften this check)</p></li>
<li><p>TIME cannot be decreasing within ID, unless <code>EVID</code> in {3,4}.</p></li>
<li><p>all ID's must have doses (<code>EVID</code> in {1,4})</p></li>
<li><p>all ID's must have observations (<code>EVID</code>==0)</p></li>
<li><p>ID's should not have leading zeros since these will be lost
when Nonmem read, then write the data.</p></li>
<li><p>If a unique row identifier is used, this must be
    non-missing, increasing, integer</p></li>
<li><p>Character values must not contain commas (they will mess up
    writing/reading csv)</p></li>
<li><p>Columns specified in covs argument must be non-missing,
    numeric and not varying within subjects.</p></li>
<li><p>Columns specified in <code>covs.occ</code> must be
    non-missing, numeric and not varying within combinations of
    subject and occasion.</p></li>
<li><p>Columns specified in <code>cols.num</code> must be present, numeric
    and non-<code>NA</code>.</p></li>
<li><p>If a unique subject identifier column (<code>col.usubjid</code>) is
provided, `col.id` must be unique within values of <code>col.usubjid</code> and
vice versa.</p></li>
<li><p>Events should not be duplicated. For all rows, the
combination of <code>col.id</code>, <code>col.cmt</code>, <code>col.evid</code>, <code>col.time</code> plus the
optional columns specified in <code>cols.dup</code> must be unique. In other
words, if a subject (<code>col.id</code>) that has say observations (<code>col.evid</code>)
at the same time (col.time), this is considered a duplicate. The
exception is if there is a reset event (<code>col.evid</code> is 3 or 4) in
between the two rows. cols.dup can be used to add columns to this
analysis. This is useful for different assays run on the same
compartment (say a DVID column) or maybe stacked datasets. If
col.cmt is of length&gt;1, this search is repeated for each cmt
column.</p></li>
</ul></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/data/xgxr2.rds"</span>, package<span class="op">=</span><span class="st">"NMdata"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">NMcheckData</span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">[</span><span class="va">EVID</span><span class="op">==</span><span class="fl">0</span>,<span class="va">LLOQ</span><span class="op">:=</span><span class="fl">3.5</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co">## expecting LLOQ only for samples</span></span></span>
<span class="r-in"><span><span class="fu">NMcheckData</span><span class="op">(</span><span class="va">dat</span>,cols.num<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"STUDY"</span><span class="op">)</span>,<span class="st">"EVID==0"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LLOQ"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Philip Delff.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>




  <script data-goatcounter="https://nmdata.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script></body></html>

