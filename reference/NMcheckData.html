<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Check data for Nonmem compatibility or check control stream for
data compatibility — NMcheckData • NMdata</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Check data for Nonmem compatibility or check control stream for
data compatibility — NMcheckData"><meta property="og:description" content="Check data in various ways for compatibility with Nonmem. Some
findings will be reported even if they will not make Nonmem fail
but because they are typical dataset issues."><meta property="og:image" content="https://philipdelff.github.io/NMdata/reference/figures/apple-touch-icon-180x180.png"><meta property="og:image:alt" content="Efficient data preparation, consistency-checking and post-processing in PK/PD modeling"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NMdata</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.15.901</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="https://htmlpreview.github.io/?https://github.com/philipdelff/NMdata/blob/master/vignettes/NMdata-cheat.html" class="external-link">Cheat Sheet</a>
    </li>
    <li>
      <a href="../articles/NMscanData.html">NMscanData: find and combine all output and input data</a>
    </li>
    <li>
      <a href="../articles/DataPrepare.html">Data Preparation Tools</a>
    </li>
    <li>
      <a href="../articles/NMdata-FAQ.html">FAQ</a>
    </li>
  </ul></li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://github.com/philipdelff/NMdata/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/philipdelff/NMdata/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Check data for Nonmem compatibility or check control stream for
data compatibility</h1>
    <small class="dont-index">Source: <a href="https://github.com/philipdelff/NMdata/blob/HEAD/R/NMcheckData.R" class="external-link"><code>R/NMcheckData.R</code></a></small>
    <div class="hidden name"><code>NMcheckData.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Check data in various ways for compatibility with Nonmem. Some
findings will be reported even if they will not make Nonmem fail
but because they are typical dataset issues.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">NMcheckData</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">file</span>,</span>
<span>  <span class="va">covs</span>,</span>
<span>  <span class="va">covs.occ</span>,</span>
<span>  <span class="va">cols.num</span>,</span>
<span>  col.id <span class="op">=</span> <span class="st">"ID"</span>,</span>
<span>  col.time <span class="op">=</span> <span class="st">"TIME"</span>,</span>
<span>  col.dv <span class="op">=</span> <span class="st">"DV"</span>,</span>
<span>  col.mdv <span class="op">=</span> <span class="st">"MDV"</span>,</span>
<span>  col.cmt <span class="op">=</span> <span class="st">"CMT"</span>,</span>
<span>  col.amt <span class="op">=</span> <span class="st">"AMT"</span>,</span>
<span>  <span class="va">col.flagn</span>,</span>
<span>  <span class="va">col.row</span>,</span>
<span>  <span class="va">col.usubjid</span>,</span>
<span>  <span class="va">na.strings</span>,</span>
<span>  return.summary <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">as.fun</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>data</dt>
<dd><p>The data to check. data.frame, data.table, tibble,
anything that can be converted to data.table.</p></dd>


<dt>file</dt>
<dd><p>Alternatively to checking a data object, you can use
file to specify a control stream to check. This can either be
a (working or non-working) input control stream or an output
control stream. In this case, NMdataCheck checks column names
in data against control stream (see NMcheckColnames), reads
the data as NONMEM would do, and do the same checks on the
data as NMdataCheck would do using the data
argument. col.flagn is ignored in this case - instead,
ACCEPT/IGNORE statements in control stream are applied. The
file argument is useful for debugging a Nonmem model.</p></dd>


<dt>covs</dt>
<dd><p>columns that contain subject-level covariates. They
are expected to be non-missing, numeric and not varying within
subjects.</p></dd>


<dt>covs.occ</dt>
<dd><p>A list specifying columns that contain
subject:occasion-level covariates. They are expected to be
non-missing, numeric and not varying within combinations of
subject and occasion. covs.occ=list(PERIOD=c("FED")) means
that FED is the covariate, while PERIOD indicates the
occasion.</p></dd>


<dt>cols.num</dt>
<dd><p>Columns that are expected to be present, numeric
and non-NA. If a character vector is given, the columns are
expected to be used in all rows. If a column is only used for
a subset of rows, use a list and name the elements by
subsetting strings. See examples.</p></dd>


<dt>col.id</dt>
<dd><p>The name of the column that holds the subject
identifier. Default is "ID".</p></dd>


<dt>col.time</dt>
<dd><p>The name of the column holding actual time.</p></dd>


<dt>col.dv</dt>
<dd><p>The name of the column holding the dependent
variable. For now, only one column can be specified, and MDV
is assumed to match this column. Default is DV.</p></dd>


<dt>col.mdv</dt>
<dd><p>The name of the column holding the binary indicator
of the dependent variable missing. Default is MDV.</p></dd>


<dt>col.cmt</dt>
<dd><p>The name(s) of the compartment column(s). These
will be checked to be positive integers for all rows. They are
also used in checks for row duplicates.</p></dd>


<dt>col.amt</dt>
<dd><p>The name of the dose amount column.</p></dd>


<dt>col.flagn</dt>
<dd><p>Optionally, the name of the column holding
numeric exclusion flags. Default value is FLAG and can be
configured using NMdataConf. Disable by using col.flagn=FALSE.</p></dd>


<dt>col.row</dt>
<dd><p>A column with a unique value for each row. Such a
column is recommended to use if possible. Default ("ROW") can
be modified using NMdataConf.</p></dd>


<dt>col.usubjid</dt>
<dd><p>Optional unique subject identifier. It is
recommended to keep a unique subject identifier (typically a
character string including an abbreviated study name and the
subject id) from the clinical datasets in the analysis set. If
you supply the name of the column holding this identifier,
NMcheckData will check that it is non-missing, that it is
unique within values of col.id (i.e. that the analysis subject
ID's are unique across actual subjects), and that col.id is
unique within the unique subject ID (a violation of the latter
is less likely).</p></dd>


<dt>na.strings</dt>
<dd><p>Strings to be accepted when trying to convert
characters to numerics. This will typically be a string that
represents missing values. Default is ".". Notice, actual NA,
i.e. not a string, is allowed independently of na.strings. See
?NMisNumeric.</p></dd>


<dt>return.summary</dt>
<dd><p>If TRUE (not default), the table summary
that is printed if quiet=FALSE is returned as well. In that
case, a list is returned, and the findings are in an element
called findings.</p></dd>


<dt>quiet</dt>
<dd><p>Keep quiet? Default is not to.</p></dd>


<dt>as.fun</dt>
<dd><p>The default is to return data as a data.frame. Pass
a function (say tibble::as_tibble) in as.fun to convert to
something else. If data.tables are wanted, use
as.fun="data.table". The default can be configured using
NMdataConf.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A table with findings</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The following checks are performed. The term "numeric"
    does not refer to a numeric representation in R, but
    compatibility with Nonmem. The character string "2" is in this
    sense a valid numeric, "id2" is not.</p><ul><li><p>Column
    names must be unique and not contain special characters</p></li>
<li><p>If an exclusion flag is used (for ACCEPT/IGNORE in Nonmem),
    elements must be non-missing and integers. If an exclusion
    flag is found, the rest of the checks are performed on rows
    where that flag equals 0 (zero) only.</p></li>
<li><p>If a unique row identifier is found, it has to be
non-missing, increasing integers.</p></li>
<li><p>col.time (TIME),
    EVID, ID, CMT, MDV: If present, elements must be non-missing
    and numeric.</p></li>
<li><p>col.time (TIME) must be non-negative</p></li>
<li><p>EVID must be in 0,1,2,3,4</p></li>
<li><p>CMT must be positive integers. However, can be missing or zero for EVID==3.</p></li>
<li><p>MDV must be the binary (1/0) representation of is.na(DV)</p></li>
<li><p>AMT must be 0 or NA for EVID 0 and 2</p></li>
<li><p>AMT must be positive for EVID 1 and 4</p></li>
<li><p>DV must be numeric</p></li>
<li><p>DV must be missing for EVID in 1,4.</p></li>
<li><p>If found, RATE must be a numeric, equaling -2 or non-negative for dosing events.</p></li>
<li><p>If found, SS must be a numeric, equaling 0 or 1 for dosing records.</p></li>
<li><p>If found, ADDL must be a non-negative integer for dosing
records. II must be present.</p></li>
<li><p>If found, II must be a non-negative integer for dosing
records. ADDL must be present.</p></li>
<li><p>ID must be positive and values cannot be disjoint (all
    records for each ID must be following each other. This is
    technically not a requirement in Nonmem but most often an
    error. Use a second ID column if you deliberately want to
    soften this check)</p></li>
<li><p>TIME cannot be decreasing within ID, unless EVID in 3,4.</p></li>
<li><p>all ID's must have doses (EVID in 1,4)</p></li>
<li><p>all ID's must have observations (EVID==0)</p></li>
<li><p>If a unique row identifier is used, this must be
    non-missing, increasing, integer</p></li>
<li><p>Character values must not contain commas (they will mess up
    writing/reading csv)</p></li>
<li><p>Columns specified in covs argument must be non-missing,
    numeric and not varying within subjects.</p></li>
<li><p>Columns specified in covs.occ must be
    non-missing, numeric and not varying within combinations of
    subject and occasion.</p></li>
<li><p>Columns specified in cols.num must be present, numeric
    and non-NA.</p></li>
<li><p>If a unique subject identifier column (col.usubjid) is
provided, col.id must be unique within values of col.usubjid and
vice versa.</p></li>
</ul></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/data/xgxr2.rds"</span>, package<span class="op">=</span><span class="st">"NMdata"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">NMcheckData</span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  column              check  N Nid</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    EVID Subject has no obs 19  19</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     MDV   Column not found  1   0</span>
<span class="r-in"><span><span class="va">dat</span><span class="op">[</span><span class="va">EVID</span><span class="op">==</span><span class="fl">0</span>,<span class="va">LLOQ</span><span class="op">:=</span><span class="fl">3.5</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        ROW  ID NOMTIME     TIME EVID CMT AMT       DV FLAG STUDY BLQ CYCLE DOSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1:    1  31     0.0  0.00000    1   1   3       NA    0     1   0     1    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    2:    2  31     0.1  0.13381    0   2   0 0.050000   10     1   1     1    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    3:    3  31     0.5  0.48619    0   2   0 0.050000   10     1   1     1    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    4:    4  31     1.0  1.00637    0   2   0 0.050000   10     1   1     1    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    5:    5  31     2.0  2.02464    0   2   0 0.050000   10     1   1     1    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ---                                                                          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1498: 1498 180     4.0  4.14220    0   2   0 0.614680    0     1   0     1  300</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1499: 1499 180     8.0  8.16823    0   2   0 0.241030    0     1   0     1  300</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1500: 1500 180    12.0 12.15164    0   2   0 0.097516    0     1   0     1  300</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1501: 1501 180    18.0 18.04313    0   2   0 0.080055    0     1   0     1  300</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1502: 1502 180    23.9 23.87067    0   2   0 0.065688    0     1   0     1  300</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       PART PROFDAY PROFTIME WEIGHTB   eff0 EVENTU             NAME TIMEUNIT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1:    1       1      0.0  87.031 56.461     mg           Dosing    Hours</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    2:    1       1      0.1  87.031 56.461  ng/mL PK Concentration    Hours</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    3:    1       1      0.5  87.031 56.461  ng/mL PK Concentration    Hours</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    4:    1       1      1.0  87.031 56.461  ng/mL PK Concentration    Hours</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    5:    1       1      2.0  87.031 56.461  ng/mL PK Concentration    Hours</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ---                                                                      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1498:    1       1      4.0  98.103 57.835  ng/mL PK Concentration    Hours</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1499:    1       1      8.0  98.103 57.835  ng/mL PK Concentration    Hours</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1500:    1       1     12.0  98.103 57.835  ng/mL PK Concentration    Hours</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1501:    1       1     18.0  98.103 57.835  ng/mL PK Concentration    Hours</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1502:    1       1     23.9  98.103 57.835  ng/mL PK Concentration    Hours</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       TRTACT         flag trtact LLOQ</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1:   3 mg       Dosing   3 mg   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    2:   3 mg   Below LLOQ   3 mg  3.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    3:   3 mg   Below LLOQ   3 mg  3.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    4:   3 mg   Below LLOQ   3 mg  3.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    5:   3 mg   Below LLOQ   3 mg  3.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ---                                </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1498: 300 mg Analysis set 300 mg  3.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1499: 300 mg Analysis set 300 mg  3.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1500: 300 mg Analysis set 300 mg  3.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1501: 300 mg Analysis set 300 mg  3.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1502: 300 mg Analysis set 300 mg  3.5</span>
<span class="r-in"><span><span class="co">## expecting LLOQ only for samples</span></span></span>
<span class="r-in"><span><span class="fu">NMcheckData</span><span class="op">(</span><span class="va">dat</span>,cols.num<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"STUDY"</span><span class="op">)</span>,<span class="st">"EVID==0"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LLOQ"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  column              check  N Nid</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    EVID Subject has no obs 19  19</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     MDV   Column not found  1   0</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Philip Delff.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  <script data-goatcounter="https://nmdata.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script></body></html>

